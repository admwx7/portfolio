<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">

<link rel="import" href="../elements/am-blog-posts.html">
<link rel="import" href="../elements/am-under-construction.html">

<dom-module id="am-page-blog">
  <template>
    <am-under-construction
    ></am-under-construction>

    <app-route id="postsRoute"
      data="{{__postData}}"
      pattern="/:id"
      route="{{route}}"
    ></app-route>
    <app-route
      active="{{__createPost}}"
      pattern="/new"
      route="{{route}}"
    ></app-route>

    <am-blog-posts
      create="{{__createPost}}"
      selected="{{__postData.id}}"
    ></am-blog-posts>
  </template>
  <script>
    /**
     * `am-page-blog` a page for managing and reading blog posts
     *
     * @customElement
     * @polymer
     * @extends Polymer.Element
     */
    class AmPageBlog extends Polymer.Element {
      // eslint-disable-next-line require-jsdoc
      static get is() {
        return 'am-page-blog';
      }
      // eslint-disable-next-line require-jsdoc
      static get properties() {
        return {
          route: {
            type: Object,
            notify: true,
          },

          __createPost: Boolean,
          __postData: Object,
        };
      }
      /* Private Methods */
      /**
       * Used to handle when selected is changed inside of <am-blog-posts and there is no trailing '/' in the path
       * @private
       *
       * @param {CustomEvent} event
       */
      __selectedChanged(event) {
        const value = event.detail.value;
        if (value && !this.$.postsRoute.active && !(this.route.path.includes(value) || this.route.path.endsWith('/'))) {
          this.set('route.path', `${this.route.path}/${value}`);
        }
      }
    }
    window.customElements.define(AmPageBlog.is, AmPageBlog);
  </script>
</dom-module>
